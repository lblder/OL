System.register(["./index-legacy-VniDFTuT.js"],function(e,t){"use strict";var r,n,i,o,a,s,l,c,y,h,d,w,f,u,p;return{setters:[e=>{r=e.u,n=e.K,i=e.dS,o=e.P,a=e.a9,s=e.ab,l=e.ad,c=e.aK,y=e.o,h=e.Q,d=e.S,w=e.O,f=e.y,u=e.c7,p=e.d_}],execute:function(){var t=l("<div id=heic-container><canvas>");e("default",()=>{const e=f(),{to:l}=r(),[g,m]=n(!0),[v,P]=n(!1),{libHeifPath:b}=i();let j=o.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===j.length&&(j=[o.obj]);const k=e=>{const t=j.findIndex(e=>e.name===o.obj.name);"ArrowLeft"===e.key&&t>0?l(j[t-1].name):"ArrowRight"===e.key&&t<j.length-1&&l(j[t+1].name)};let x,_,C;a(()=>{window.addEventListener("keydown",k),E()}),s(()=>{window.removeEventListener("keydown",k),x&&_&&(_=null),x=null});const E=async()=>{m(!0),P(!1);try{window.libheif||await I(`${b()}/libheif.js`,"libheif-script");const e=await $(`${b()}/libheif.wasm`);x=window.libheif({wasmBinary:e}),_=new x.HeifDecoder,await H(o.raw_url)}catch(e){console.error("HEIC初始化失败:",e),P(!0),m(!1)}},I=(e,t)=>new Promise((r,n)=>{const i=document.createElement("script");i.src=e,i.id=t,i.onload=()=>r(),i.onerror=()=>n(`脚本加载失败: ${e}`),document.head.appendChild(i)}),$=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},H=async e=>{try{m(!0),P(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const r=await t.arrayBuffer(),n=_.decode(r);if(!n||0===n.length)throw"没有可解码的图像";const i=n[0];await S(i),m(!1)}catch(t){console.error("HEIC解码失败:",t),P(!0),m(!1)}},S=e=>new Promise(t=>{if(!C)return t();const r=e.get_width(),n=e.get_height();C.width=r,C.height=n;const i=new ImageData(r,n);e.display(i,e=>{if(!e||!C)return t();const r=C.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()})});return A=t(),B=A.firstChild,A.style.setProperty("position","relative"),A.style.setProperty("width","100%"),A.style.setProperty("height","75vh"),A.style.setProperty("display","flex"),A.style.setProperty("justify-content","center"),A.style.setProperty("align-items","center"),A.style.setProperty("overflow","hidden"),"function"==typeof C?p(C,B):C=B,B.style.setProperty("max-width","100%"),B.style.setProperty("max-height","100%"),B.style.setProperty("object-fit","contain"),c(A,y(d,{get when(){return g()},get children(){return y(h,{})}}),null),c(A,y(d,{get when(){return v()},get children(){return y(w,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),u(e=>null!=(e=g()||v()?"none":"block")?B.style.setProperty("display",e):B.style.removeProperty("display")),A;var A,B})}}});
