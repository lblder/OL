System.register(["./index-legacy-VniDFTuT.js","./StreamSaver-legacy-CjcahN-l.js"],function(e,t){"use strict";var n,a,r,c,o,i,l,s,u,d,g,h,m,p,f,w,_,$,k,y;return{setters:[e=>{n=e.K,a=e.y,r=e.u,c=e.a$,o=e.o,i=e.X,l=e.bV,s=e.W,u=e.F,d=e.V,g=e.aJ,h=e.aL,m=e.aM,p=e.S,f=e.ci,w=e.cH,_=e.b5,$=e.cI,k=e._},e=>{y=e.s}],execute:function(){y.mitm="/streamer/mitm.html";let t=0;e("default",e=>{const S=a(),[b,v]=n(S("home.package_download.initializing")),[z,x]=n(0),{pathname:I,isShare:W}=r(),j=c(),C=async(e,n)=>{if(n.is_dir){const t=await $(_(I(),e,n.name),k());if(200!==t.code)return t.message;const a=[];for(const r of t.data.content??[]){const t=await C(_(e,n.name),r);if("string"==typeof t)return t;a.push(...t)}return a}return t+=n.size,[{path:_(e,n.name),url:w(_(I(),e),n,"direct",W(),!0)}]},[F,T]=n([]);return(async()=>{let e=f(I());1===j.length&&(e=j[0].name),e||(e=S("manage.sidemenu.home"));let n=y.createWriteStream(`${e}.zip`,{size:t});v(S("home.package_download.fetching_struct")),x(2);const a=[];for(const t of j){const e=await C("",t);if("string"==typeof e)return v(`${S("home.package_download.fetching_struct_failed")}: ${e}`),x(1),e;a.push(...e)}v(S("home.package_download.downloading")),x(3);let r=a.values(),c=new window.ZIP({pull(t){const n=r.next();if(!n.done){let a=n.value.path.replace(/^\/+|\/+$/g,"");1===j.length&&(a=a.replace(`${e}/`,""));const r=n.value.url;return fetch(r).then(e=>{T(e=>[...e,a]),t.enqueue({name:a,stream:e.body})})}t.close()}});window.WritableStream&&c.pipeTo&&c.pipeTo(n).then(()=>{v(`${S("home.package_download.success")}`),x(4)}).catch(e=>{v(`${S("home.package_download.failed")}: ${e}`),x(1)})})(),[o(g,{get children(){return o(i,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[o(l,{get children(){return[s(()=>S("home.package_download.current_status")),": ",s(()=>b())]}}),o(u,{get each(){return F()},children:e=>o(d,{css:{wordBreak:"break-all"},get children(){return["Fetching: ",e]}})})]}})}}),o(p,{get when(){return[1,4].includes(z())},get children(){return o(h,{get children(){return o(m,{colorScheme:"info",get onClick(){return e.onClose},get children(){return S("global.close")}})}})}})]})}}});
