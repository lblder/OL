import{B as s,b9 as $,C as J,O as Q,D as e,ae as n,au as l,ad as i,o as X,K as h,dj as Y,d6 as R,d7 as M,al as C,d8 as L,d9 as O,af as f,cs as j,db as Z,dc as ee,dd as D,de as p,df as te,R as re,dg as b,L as ne,M as ae,E as ce,F as ie,bx as se,G as le,bU as A,bH as F,bI as de,bK as oe,bM as ue,bO as ge,bP as he,bQ as I,bR as B,dk as E,I as fe,J as pe,r as _,bw as m}from"./index-DKKy_Uoh.js";import{b as be}from"./useTitle-C5NycKOZ.js";import{h as me,i as we,j as ye,k as $e}from"./certificate-xES4-7uY.js";const Te=()=>{const t=X();be("certificate.title");const[a,U]=s(null),[S,T]=s([]),[z,H]=$(me),[,q]=$(we),[w,v]=s("user"),[y,x]=s(""),[o,k]=s({}),[N,u]=s(!1),[,W]=$(ye);J(()=>{H().then(r=>{m(r,c=>U(c))}),q().then(r=>{m(r,c=>T(c||[]))})});const K=Q(()=>S().some(r=>r.status==="pending")),P=()=>{const r={};return w()||(r.type=t("certificate.type_required")),y()||(r.reason=t("certificate.reason_required")),k(r),Object.keys(r).length===0},V=async()=>{if(!P())return;const r=await W({type:w(),reason:y()});m(r,()=>{_.success(t("certificate.request_created")),u(!1),v("user"),x(""),k({}),q().then(c=>{m(c,g=>T(g||[]))})})},G=async()=>{var r;try{const c=await $e(),g=URL.createObjectURL(c),d=document.createElement("a");d.href=g,d.download="".concat(((r=a())==null?void 0:r.name)||"certificate",".crt"),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(g),_.success(t("certificate.download_started"))}catch(c){_.error("".concat(t("certificate.download_started")," - ").concat(c.message))}};return e(f,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[e(l,{justifyContent:"space-between",w:"$full",get children(){return[e(i,{fontSize:"$2xl",fontWeight:"$bold",get children(){return t("certificate.title")}}),e(h,{colorScheme:"primary",onClick:()=>u(!0),get children(){return t("certificate.request_certificate")}})]}}),n(()=>n(()=>!!z())()?e(l,{spacing:"$2",get children(){return[e(Y,{size:"sm"}),e(i,{get children(){return t("global.loading")}})]}}):[n(()=>n(()=>!a())()?e(R,{status:"info",get children(){return[e(M,{}),e(C,{flex:"1",get children(){return[e(L,{get children(){return t("certificate.no_certificates")}}),e(O,{display:"block",get children(){return t("certificate.no_certificates_desc")}})]}})]}}):e(f,{w:"$full",spacing:"$4",p:"$4",border:"1px solid $neutral7",rounded:"$md",get children(){return[e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{fontWeight:"$semibold",get children(){return a().name}}),e(j,{get colorScheme(){return n(()=>a().status==="valid")()?"success":a().status==="expiring"?"warning":"neutral"},get children(){return t("certificate.".concat(a().status))}})]}}),e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{get children(){return[n(()=>t("certificate.type")),": ",n(()=>t("certificate.".concat(a().type)))]}}),e(i,{get children(){return[n(()=>t("certificate.owner")),": ",n(()=>a().owner)]}})]}}),e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{get children(){return[n(()=>t("certificate.issued_date")),": ",n(()=>n(()=>!!a().issued_date)()?new Date(a().issued_date).toLocaleDateString():"N/A")]}}),e(i,{get children(){return[n(()=>t("certificate.expiration_date")),": ",n(()=>n(()=>!!a().expiration_date)()?new Date(a().expiration_date).toLocaleDateString():"N/A")]}})]}}),e(h,{onClick:G,get children(){return t("certificate.download")}})]}})),n(()=>n(()=>!!K())()?e(f,{w:"$full",spacing:"$4",get children(){return[e(i,{fontSize:"$lg",fontWeight:"$semibold",get children(){return t("certificate.certificate_requests")}}),e(C,{w:"$full",overflowX:"auto",get children(){return e(Z,{dense:!0,get children(){return[e(ee,{get children(){return e(D,{get children(){return[e(p,{get children(){return t("certificate.type")}}),e(p,{get children(){return t("certificate.reason")}}),e(p,{get children(){return t("certificate.status")}}),e(p,{get children(){return t("certificate.created_at")}})]}})}}),e(te,{get children(){return e(re,{get each(){return S()},children:r=>e(D,{get children(){return[e(b,{get children(){return t("certificate.".concat(r.type))}}),e(b,{get children(){return r.reason}}),e(b,{get children(){return e(j,{get colorScheme(){return r.status==="pending"?"warning":r.status==="valid"?"success":"danger"},get children(){return t("certificate.".concat(r.status))}})}}),e(b,{get children(){return n(()=>!!r.created_at)()?new Date(r.created_at).toLocaleDateString():"N/A"}})]}})})}})]}})}})]}}):e(R,{status:"info",get children(){return[e(M,{}),e(C,{flex:"1",get children(){return[e(L,{get children(){return t("certificate.no_requests")}}),e(O,{display:"block",get children(){return t("certificate.no_requests_desc")}})]}})]}}))]),e(ne,{get opened(){return N()},onClose:()=>u(!1),get children(){return[e(ae,{}),e(ce,{get children(){return[e(ie,{get children(){return t("certificate.request_certificate")}}),e(se,{}),e(le,{get children(){return e(f,{spacing:"$4",get children(){return[e(A,{get invalid(){return!!o().type},get children(){return[e(F,{get children(){return t("certificate.type")}}),e(de,{get value(){return w()},onChange:r=>v(r),get children(){return[e(oe,{get children(){return e(ue,{})}}),e(ge,{get children(){return e(he,{get children(){return[e(I,{value:"user",get children(){return e(B,{get children(){return t("certificate.user")}})}}),e(I,{value:"node",get children(){return e(B,{get children(){return t("certificate.node")}})}})]}})}})]}}),e(E,{get children(){return o().type}})]}}),e(A,{get invalid(){return!!o().reason},get children(){return[e(F,{get children(){return t("certificate.reason")}}),e(fe,{get value(){return y()},onInput:r=>x(r.currentTarget.value),get placeholder(){return t("certificate.reason_placeholder")}}),e(E,{get children(){return o().reason}})]}})]}})}}),e(pe,{get children(){return e(l,{spacing:"$2",get children(){return[e(h,{onClick:()=>u(!1),get children(){return t("global.cancel")}}),e(h,{colorScheme:"primary",onClick:V,get children(){return t("global.submit")}})]}})}})]}})]}})]}})};export{Te as default};
