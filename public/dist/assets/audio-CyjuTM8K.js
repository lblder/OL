import{A as k}from"./APlayer.min-_9IZvi8h.js";import{a0 as y,u as h,P as o,a9 as L,ab as x,o as C,a2 as S,am as A,a5 as M,dW as U,dX as s,x as b}from"./index-CsB5zT4W.js";import{a as I}from"./useTitle-C7kyrev7.js";import{O as m}from"./icon-BfaWsS4s.js";import"./index-Bc2gP8al.js";import"./index-DBnL0RpI.js";const j=()=>{const{proxyLink:p,rawLink:u,previewPage:f}=y(),{searchParams:w}=h();let l=o.objs.filter(r=>r.type===m.AUDIO);(l.length===0||w.from==="search")&&(l=[o.obj]);let e;const v=r=>{let c;const n=o.objs.find(t=>s(t.name)===s(r.name)&&t.name.endsWith(".lrc"));n&&(c=p(n,!0));let a;const d=o.objs.find(t=>t.type===m.IMAGE&&(s(t.name).toLowerCase()===s(r.name).toLowerCase()||s(t.name).toLowerCase()==="front"||s(t.name).toLowerCase()==="cover"||s(t.name).toLowerCase()==="folder"));d?a=u(d,!0):a=r.thumb||b("audio_cover")||"https://res.oplist.org/logo/logo.svg";const i={name:r.name,artist:"Unknown",url:u(r,!0),cover:a,lrc:c};if(o.provider==="NeteaseMusic"){const t=r.name.match(/((.+)\s-\s)?(.+)\.(mp3|flac)/);i.artist=(t==null?void 0:t[2])||"Unknown",i.name=(t==null?void 0:t[3])||r.name;const g=new URL(f(r).replace(/\.(mp3|flac)/,".lrc"));i.lrc=decodeURIComponent(g.pathname)}return i};return L(()=>{e=new k({container:document.querySelector("#audio-player"),mini:!1,autoplay:M("audio_autoplay"),theme:A(),loop:"all",order:"list",preload:"auto",volume:.7,mutex:!0,listFolded:!1,lrcType:o.provider==="NeteaseMusic"?1:3,audio:l.map(v)});const r=e.lrc.switch,c=e.lrc.update;e.lrc.switch=a=>{e.lrc.update=()=>{},r.call(e.lrc,a),e.lrc.update=c},o.provider==="NeteaseMusic"&&e.on("loadstart",()=>{const a=e.list.index;if(!e.list.audios[a].lrc)return;const d=e.list.audios[a].lrc;U(d).then(i=>{e.lrc.async=!0,e.lrc.parsed[a]=void 0,e.list.audios[a].lrc=i.data.raw_url,e.lrc.switch(a),e.list.audios[a].lrc="",e.lrc.async=!1})});const n=l.findIndex(a=>a.name===o.obj.name);n!==-1&&e.list.switch(n),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("seekto",a=>e.seek(a.seekTime)),e.list.audios.length>1&&(navigator.mediaSession.setActionHandler("previoustrack",()=>{e.skipBack()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{e.skipForward()})),e.on("play",()=>{const a=e.list.audios[e.list.index];I(a.name),navigator.mediaSession.metadata=new MediaMetadata({title:a.name,artist:a.artist==="Unknown"?void 0:a.artist,artwork:[{src:a.cover}]})}))}),x(()=>{e==null||e.destroy()}),C(S,{w:"$full",id:"audio-player"})};export{j as default};
