System.register(["./index-legacy-VniDFTuT.js","./StreamSaver-legacy-CjcahN-l.js"],function(e,t){"use strict";var n,a,r,c,o,i,s,l,u,d,g,h,m,p,f,w,_,$,k,y;return{setters:[e=>{n=e.K,a=e.y,r=e.u,c=e.a$,o=e.o,i=e.X,s=e.bV,l=e.W,u=e.F,d=e.V,g=e.aJ,h=e.aL,m=e.aM,p=e.S,f=e.ci,w=e.cH,_=e.b5,$=e.cI,k=e._},e=>{y=e.s}],execute:function(){y.mitm="/streamer/mitm.html";let t=0;e("default",e=>{const S=a(),[b,v]=n(S("home.package_download.initializing")),[z,W]=n(0),{pathname:x,isShare:I}=r(),j=c(),C=async(e,n)=>{if(n.is_dir){let t=_(x(),e,n.name);t.startsWith("/@tenant/data")&&(t=t.substring(13)||"/");const a=await $(t,k());if(200!==a.code)return a.message;const r=[];for(const c of a.data.content??[]){const t=await C(_(e,n.name),c);if("string"==typeof t)return t;r.push(...t)}return r}return t+=n.size,[{path:_(e,n.name),url:w(_(x(),e),n,"direct",I(),!0)}]},[F,T]=n([]);return(async()=>{let e=f(x());1===j.length&&(e=j[0].name),e||(e=S("manage.sidemenu.home"));let n=y.createWriteStream(`${e}.zip`,{size:t});v(S("home.package_download.fetching_struct")),W(2);const a=[];for(const t of j){const e=await C("",t);if("string"==typeof e)return v(`${S("home.package_download.fetching_struct_failed")}: ${e}`),W(1),e;a.push(...e)}v(S("home.package_download.downloading")),W(3);let r=a.values(),c=new window.ZIP({pull(t){const n=r.next();if(!n.done){let a=n.value.path.replace(/^\/+|\/+$/g,"");1===j.length&&(a=a.replace(`${e}/`,""));const r=n.value.url;return fetch(r).then(e=>{T(e=>[...e,a]),t.enqueue({name:a,stream:e.body})})}t.close()}});window.WritableStream&&c.pipeTo&&c.pipeTo(n).then(()=>{v(`${S("home.package_download.success")}`),W(4)}).catch(e=>{v(`${S("home.package_download.failed")}: ${e}`),W(1)})})(),[o(g,{get children(){return o(i,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[o(s,{get children(){return[l(()=>S("home.package_download.current_status")),": ",l(()=>b())]}}),o(u,{get each(){return F()},children:e=>o(d,{css:{wordBreak:"break-all"},get children(){return["Fetching: ",e]}})})]}})}}),o(p,{get when(){return[1,4].includes(z())},get children(){return o(h,{get children(){return o(m,{colorScheme:"info",get onClick(){return e.onClose},get children(){return S("global.close")}})}})}})]})}}});
