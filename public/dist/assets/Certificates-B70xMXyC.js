import{K as s,aZ as $,J as P,g as Z,o as e,W as n,ac as l,V as i,y as K,aM as h,d0 as Q,cP as R,cQ as M,a2 as C,cR as L,cS as D,X as f,ck as j,cU as Y,cV as ee,cW as F,cX as p,cY as te,F as re,cZ as b,aN as ne,aG as ce,aH as ae,aI as ie,bm as se,aJ as le,bJ as O,bw as A,bx as oe,bz as ue,bB as de,bD as ge,bE as he,bF as B,bG as E,d1 as I,bg as fe,aL as pe,bh as _,bl as m}from"./index-CsB5zT4W.js";import{b as be}from"./useTitle-C7kyrev7.js";import{h as me,i as ye,j as we,k as $e}from"./certificate-BkOvkjL-.js";const Te=()=>{const t=K();be("certificate.title");const[c,U]=s(null),[S,T]=s([]),[W,z]=$(me),[,q]=$(ye),[y,v]=s("user"),[w,x]=s(""),[u,k]=s({}),[N,d]=s(!1),[,V]=$(we);P(()=>{z().then(r=>{m(r,a=>U(a))}),q().then(r=>{m(r,a=>T(a||[]))})});const H=Z(()=>S().some(r=>r.status==="pending")),J=()=>{const r={};return y()||(r.type=t("certificate.type_required")),w()||(r.reason=t("certificate.reason_required")),k(r),Object.keys(r).length===0},X=async()=>{if(!J())return;const r=await V({type:y(),reason:w()});m(r,()=>{_.success(t("certificate.request_created")),d(!1),v("user"),x(""),k({}),q().then(a=>{m(a,g=>T(g||[]))})})},G=async()=>{var r;try{const a=await $e(),g=URL.createObjectURL(a),o=document.createElement("a");o.href=g,o.download="".concat(((r=c())==null?void 0:r.name)||"certificate",".crt"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(g),_.success(t("certificate.download_started"))}catch(a){_.error("".concat(t("certificate.download_started")," - ").concat(a.message))}};return e(f,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[e(l,{justifyContent:"space-between",w:"$full",get children(){return[e(i,{fontSize:"$2xl",fontWeight:"$bold",get children(){return t("certificate.title")}}),e(h,{colorScheme:"primary",onClick:()=>d(!0),get children(){return t("certificate.request_certificate")}})]}}),n(()=>n(()=>!!W())()?e(l,{spacing:"$2",get children(){return[e(Q,{size:"sm"}),e(i,{get children(){return t("global.loading")}})]}}):[n(()=>n(()=>!c())()?e(R,{status:"info",get children(){return[e(M,{}),e(C,{flex:"1",get children(){return[e(L,{get children(){return t("certificate.no_certificates")}}),e(D,{display:"block",get children(){return t("certificate.no_certificates_desc")}})]}})]}}):e(f,{w:"$full",spacing:"$4",p:"$4",border:"1px solid $neutral7",rounded:"$md",get children(){return[e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{fontWeight:"$semibold",get children(){return c().name}}),e(j,{get colorScheme(){return n(()=>c().status==="valid")()?"success":c().status==="expiring"?"warning":"neutral"},get children(){return t("certificate.".concat(c().status))}})]}}),e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{get children(){return[n(()=>t("certificate.type")),": ",n(()=>t("certificate.".concat(c().type)))]}}),e(i,{get children(){return[n(()=>t("certificate.owner")),": ",n(()=>c().owner)]}})]}}),e(l,{w:"$full",justifyContent:"space-between",get children(){return[e(i,{get children(){return[n(()=>t("certificate.issued_date")),": ",n(()=>n(()=>!!c().issued_date)()?new Date(c().issued_date).toLocaleDateString():"N/A")]}}),e(i,{get children(){return[n(()=>t("certificate.expiration_date")),": ",n(()=>n(()=>!!c().expiration_date)()?new Date(c().expiration_date).toLocaleDateString():"N/A")]}})]}}),e(h,{onClick:G,get children(){return t("certificate.download")}})]}})),n(()=>n(()=>!!H())()?e(f,{w:"$full",spacing:"$4",get children(){return[e(i,{fontSize:"$lg",fontWeight:"$semibold",get children(){return t("certificate.certificate_requests")}}),e(C,{w:"$full",overflowX:"auto",get children(){return e(Y,{dense:!0,get children(){return[e(ee,{get children(){return e(F,{get children(){return[e(p,{get children(){return t("certificate.type")}}),e(p,{get children(){return t("certificate.reason")}}),e(p,{get children(){return t("certificate.status")}}),e(p,{get children(){return t("certificate.created_at")}})]}})}}),e(te,{get children(){return e(re,{get each(){return S()},children:r=>e(F,{get children(){return[e(b,{get children(){return t("certificate.".concat(r.type))}}),e(b,{get children(){return r.reason}}),e(b,{get children(){return e(j,{get colorScheme(){return r.status==="pending"?"warning":r.status==="valid"?"success":"danger"},get children(){return t("certificate.".concat(r.status))}})}}),e(b,{get children(){return n(()=>!!r.created_at)()?new Date(r.created_at).toLocaleDateString():"N/A"}})]}})})}})]}})}})]}}):e(R,{status:"info",get children(){return[e(M,{}),e(C,{flex:"1",get children(){return[e(L,{get children(){return t("certificate.no_requests")}}),e(D,{display:"block",get children(){return t("certificate.no_requests_desc")}})]}})]}}))]),e(ne,{get opened(){return N()},onClose:()=>d(!1),get children(){return[e(ce,{}),e(ae,{get children(){return[e(ie,{get children(){return t("certificate.request_certificate")}}),e(se,{}),e(le,{get children(){return e(f,{spacing:"$4",get children(){return[e(O,{get invalid(){return!!u().type},get children(){return[e(A,{get children(){return t("certificate.type")}}),e(oe,{get value(){return y()},onChange:r=>v(r),get children(){return[e(ue,{get children(){return e(de,{})}}),e(ge,{get children(){return e(he,{get children(){return[e(B,{value:"user",get children(){return e(E,{get children(){return t("certificate.user")}})}}),e(B,{value:"node",get children(){return e(E,{get children(){return t("certificate.node")}})}})]}})}})]}}),e(I,{get children(){return u().type}})]}}),e(O,{get invalid(){return!!u().reason},get children(){return[e(A,{get children(){return t("certificate.reason")}}),e(fe,{get value(){return w()},onInput:r=>x(r.currentTarget.value),get placeholder(){return t("certificate.reason_placeholder")}}),e(I,{get children(){return u().reason}})]}})]}})}}),e(pe,{get children(){return e(l,{spacing:"$2",get children(){return[e(h,{onClick:()=>d(!1),get children(){return t("global.cancel")}}),e(h,{colorScheme:"primary",onClick:X,get children(){return t("global.submit")}})]}})}})]}})]}})]}})};export{Te as default};
