System.register([],function(e,t){"use strict";return{execute:function(){/*! @viselect/vanilla v3.9.0 MIT | https://github.com/Simonwep/selection/tree/master/packages/vanilla */class t{constructor(){this._listeners=new Map,this.on=this.addEventListener,this.off=this.removeEventListener,this.emit=this.dispatchEvent}addEventListener(e,t){const s=this._listeners.get(e)??new Set;return this._listeners.set(e,s),s.add(t),this}removeEventListener(e,t){var s;return null==(s=this._listeners.get(e))||s.delete(t),this}dispatchEvent(e,...t){let s=!0;for(const i of this._listeners.get(e)??[])s=!1!==i(...t)&&s;return s}unbindAllListeners(){this._listeners.clear()}}const s=(e,t="px")=>"number"==typeof e?e+t:e,i=({style:e},t,i)=>{if("object"==typeof t)for(const[o,l]of Object.entries(t))void 0!==l&&(e[o]=s(l));else void 0!==i&&(e[t]=s(i))},o=(e=0,t=0,s=0,i=0)=>{const o={x:e,y:t,width:s,height:i,top:t,left:e,right:e+s,bottom:t+i};return{...o,toJSON:()=>JSON.stringify(o)}},l=(e,t,s="touch")=>{switch(s){case"center":{const s=t.left+t.width/2,i=t.top+t.height/2;return s>=e.left&&s<=e.right&&i>=e.top&&i<=e.bottom}case"cover":return t.left>=e.left&&t.top>=e.top&&t.right<=e.right&&t.bottom<=e.bottom;case"touch":return e.right>=t.left&&e.left<=t.right&&e.bottom>=t.top&&e.top<=t.bottom}},n=e=>Array.isArray(e)?e:[e],r=e=>(t,s,i,o={})=>{(t instanceof HTMLCollection||t instanceof NodeList)&&(t=Array.from(t)),s=n(s),t=n(t);for(const l of t)if(l)for(const t of s)l[e](t,i,{capture:!1,...o})},a=r("addEventListener"),c=r("removeEventListener"),h=e=>{var t;const{clientX:s,clientY:i,target:o}=(null==(t=e.touches)?void 0:t[0])??e;return{x:s,y:i,target:o}},d=(e,t=document)=>n(e).map(e=>"string"==typeof e?Array.from(t.querySelectorAll(e)):e instanceof Element?e:null).flat().filter(Boolean),{abs:u,max:_,min:p,ceil:m}=Math,v=(e=[])=>({stored:e,selected:[],touched:[],changed:{added:[],removed:[]}}),g=class extends t{constructor(e){var t,s,l,n,r;super(),this._selection=v(),this._targetBoundaryScrolled=!0,this._selectables=[],this._areaLocation={y1:0,x2:0,y2:0,x1:0},this._areaRect=o(),this._singleClick=!0,this._scrollAvailable=!0,this._scrollingActive=!1,this._scrollSpeed={x:0,y:0},this._scrollDelta={x:0,y:0},this._lastMousePosition={x:0,y:0},this.enable=this._toggleStartEvents,this.disable=this._toggleStartEvents.bind(this,!1),this._options={selectionAreaClass:"selection-area",selectionContainerClass:void 0,selectables:[],document:window.document,startAreas:["html"],boundaries:["html"],container:"body",...e,behaviour:{overlap:"invert",intersect:"touch",triggers:[0],...e.behaviour,startThreshold:null!=(t=e.behaviour)&&t.startThreshold?"number"==typeof e.behaviour.startThreshold?e.behaviour.startThreshold:{x:10,y:10,...e.behaviour.startThreshold}:{x:10,y:10},scrolling:{speedDivider:10,manualSpeed:750,...null==(s=e.behaviour)?void 0:s.scrolling,startScrollMargins:{x:0,y:0,...null==(n=null==(l=e.behaviour)?void 0:l.scrolling)?void 0:n.startScrollMargins}}},features:{range:!0,touch:!0,deselectOnBlur:!1,...e.features,singleTap:{allow:!0,intersect:"native",...null==(r=e.features)?void 0:r.singleTap}}};for(const i of Object.getOwnPropertyNames(Object.getPrototypeOf(this)))"function"==typeof this[i]&&(this[i]=this[i].bind(this));const{document:a,selectionAreaClass:c,selectionContainerClass:h}=this._options;this._area=a.createElement("div"),this._clippingElement=a.createElement("div"),this._clippingElement.appendChild(this._area),this._area.classList.add(c),h&&this._clippingElement.classList.add(h),i(this._area,{willChange:"top, left, bottom, right, width, height",top:0,left:0,position:"fixed"}),i(this._clippingElement,{overflow:"hidden",position:"fixed",transform:"translate3d(0, 0, 0)",pointerEvents:"none",zIndex:"1"}),this._frame=(e=>{let t,s=-1,i=!1;return{next:(...o)=>{t=o,i||(i=!0,s=requestAnimationFrame(()=>{e(...t),i=!1}))},cancel:()=>{cancelAnimationFrame(s),i=!1}}})(e=>{this._recalculateSelectionAreaRect(),this._updateElementSelection(),this._emitEvent("move",e),this._redrawSelectionArea()}),this.enable()}_toggleStartEvents(e=!0){const{document:t,features:s}=this._options,i=e?a:c;i(t,"mousedown",this._onTapStart),s.touch&&i(t,"touchstart",this._onTapStart,{passive:!1})}_onTapStart(e,t=!1){const{x:s,y:i,target:o}=h(e),{document:n,startAreas:r,boundaries:c,features:u,behaviour:_}=this._options,p=o.getBoundingClientRect();if(e instanceof MouseEvent&&!((e,t)=>t.some(t=>"number"==typeof t?e.button===t:"object"==typeof t&&t.button===e.button&&t.modifiers.every(t=>{switch(t){case"alt":return e.altKey;case"ctrl":return e.ctrlKey||e.metaKey;case"shift":return e.shiftKey}})))(e,_.triggers))return;const m=d(r,n),v=d(c,n);this._targetElement=v.find(e=>l(e.getBoundingClientRect(),p));const g=e.composedPath(),f=m.find(e=>g.includes(e));if(this._targetBoundary=v.find(e=>g.includes(e)),!this._targetElement||!f||!this._targetBoundary||!t&&!1===this._emitEvent("beforestart",e))return;this._areaLocation={x1:s,y1:i,x2:0,y2:0};const y=n.scrollingElement??n.body;this._scrollDelta={x:y.scrollLeft,y:y.scrollTop},this._singleClick=!0,this.clearSelection(!1,!0),a(n,["touchmove","mousemove"],this._delayedTapMove,{passive:!1}),a(n,["mouseup","touchcancel","touchend"],this._onTapStop),a(n,"scroll",this._onScroll),u.deselectOnBlur&&(this._targetBoundaryScrolled=!1,a(this._targetBoundary,"scroll",this._onStartAreaScroll))}_onSingleTap(e){const{singleTap:{intersect:t},range:s}=this._options.features,i=h(e);let o;if("native"===t)o=i.target;else if("touch"===t){this.resolveSelectables();const{x:e,y:t}=i;o=this._selectables.find(s=>{const{right:i,left:o,top:l,bottom:n}=s.getBoundingClientRect();return e<i&&e>o&&t<n&&t>l})}if(!o)return;for(this.resolveSelectables();!this._selectables.includes(o);){if(!o.parentElement)return void(this._targetBoundaryScrolled||this.clearSelection());o=o.parentElement}const{stored:l}=this._selection;if(this._emitEvent("start",e),e.shiftKey&&s&&this._latestElement){const e=this._latestElement,[t,s]=4&e.compareDocumentPosition(o)?[o,e]:[e,o],i=[...this._selectables.filter(e=>4&e.compareDocumentPosition(t)&&2&e.compareDocumentPosition(s)),t,s];this.select(i),this._latestElement=e}else l.includes(o)&&(1===l.length||e.ctrlKey||l.every(e=>this._selection.stored.includes(e)))?this.deselect(o):(this.select(o),this._latestElement=o)}_delayedTapMove(e){const{container:t,document:s,behaviour:{startThreshold:o}}=this._options,{x1:l,y1:n}=this._areaLocation,{x:r,y:_}=h(e);if("number"==typeof o&&u(r+_-(l+n))>=o||"object"==typeof o&&u(r-l)>=o.x||u(_-n)>=o.y){if(c(s,["mousemove","touchmove"],this._delayedTapMove,{passive:!1}),!1===this._emitEvent("beforedrag",e))return void c(s,["mouseup","touchcancel","touchend"],this._onTapStop);a(s,["mousemove","touchmove"],this._onTapMove,{passive:!1}),i(this._area,"display","block"),d(t,s)[0].appendChild(this._clippingElement),this.resolveSelectables(),this._singleClick=!1,this._targetRect=this._targetElement.getBoundingClientRect(),this._scrollAvailable=this._targetElement.scrollHeight!==this._targetElement.clientHeight||this._targetElement.scrollWidth!==this._targetElement.clientWidth,this._scrollAvailable&&(a(this._targetElement,"wheel",this._wheelScroll,{passive:!1}),a(this._options.document,"keydown",this._keyboardScroll,{passive:!1}),this._selectables=this._selectables.filter(e=>this._targetElement.contains(e))),this._setupSelectionArea(),this._emitEvent("start",e),this._onTapMove(e)}this._handleMoveEvent(e)}_setupSelectionArea(){const{_clippingElement:e,_targetElement:t,_area:s}=this,o=this._targetRect=t.getBoundingClientRect();this._scrollAvailable?(i(e,{top:o.top,left:o.left,width:o.width,height:o.height}),i(s,{marginTop:-o.top,marginLeft:-o.left})):(i(e,{top:0,left:0,width:"100%",height:"100%"}),i(s,{marginTop:0,marginLeft:0}))}_onTapMove(e){const{_scrollSpeed:t,_areaLocation:s,_options:i,_frame:o}=this,{speedDivider:l}=i.behaviour.scrolling,n=this._targetElement,{x:r,y:a}=h(e);if(s.x2=r,s.y2=a,this._lastMousePosition.x=r,this._lastMousePosition.y=a,this._scrollAvailable&&!this._scrollingActive&&(t.y||t.x)){this._scrollingActive=!0;const i=()=>{if(!t.x&&!t.y)return void(this._scrollingActive=!1);const{scrollTop:r,scrollLeft:a}=n;t.y&&(n.scrollTop+=m(t.y/l),s.y1-=n.scrollTop-r),t.x&&(n.scrollLeft+=m(t.x/l),s.x1-=n.scrollLeft-a),o.next(e),requestAnimationFrame(i)};requestAnimationFrame(i)}else o.next(e);this._handleMoveEvent(e)}_handleMoveEvent(e){const{features:t}=this._options;(t.touch&&matchMedia("(hover: none), (pointer: coarse)").matches||this._scrollAvailable&&"safari"in window)&&e.preventDefault()}_onScroll(){const{_scrollDelta:e,_options:{document:t}}=this,{scrollTop:s,scrollLeft:i}=t.scrollingElement??t.body;this._areaLocation.x1+=e.x-i,this._areaLocation.y1+=e.y-s,e.x=i,e.y=s,this._setupSelectionArea(),this._frame.next(null)}_onStartAreaScroll(){this._targetBoundaryScrolled=!0,c(this._targetElement,"scroll",this._onStartAreaScroll)}_wheelScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s=e.deltaY?e.deltaY>0?1:-1:0,i=e.deltaX?e.deltaX>0?1:-1:0;this._scrollSpeed.y+=s*t,this._scrollSpeed.x+=i*t,this._onTapMove(e),e.preventDefault()}_keyboardScroll(e){const{manualSpeed:t}=this._options.behaviour.scrolling,s="ArrowLeft"===e.key?-1:"ArrowRight"===e.key?1:0,i="ArrowUp"===e.key?-1:"ArrowDown"===e.key?1:0;this._scrollSpeed.x+=Math.sign(s)*t,this._scrollSpeed.y+=Math.sign(i)*t,e.preventDefault(),this._onTapMove({clientX:this._lastMousePosition.x,clientY:this._lastMousePosition.y,preventDefault:()=>{}})}_recalculateSelectionAreaRect(){const{_scrollSpeed:e,_areaLocation:t,_targetElement:s,_options:i}=this,{scrollTop:l,scrollHeight:n,clientHeight:r,scrollLeft:a,scrollWidth:c,clientWidth:h}=s,d=this._targetRect,{x1:m,y1:v}=t;let{x2:g,y2:f}=t;const{behaviour:{scrolling:{startScrollMargins:y}}}=i;g<d.left+y.x?(e.x=a?-u(d.left-g+y.x):0,g=g<d.left?d.left:g):g>d.right-y.x?(e.x=c-a-h?u(d.left+d.width-g-y.x):0,g=g>d.right?d.right:g):e.x=0,f<d.top+y.y?(e.y=l?-u(d.top-f+y.y):0,f=f<d.top?d.top:f):f>d.bottom-y.y?(e.y=n-l-r?u(d.top+d.height-f-y.y):0,f=f>d.bottom?d.bottom:f):e.y=0;const b=p(m,g),S=p(v,f),E=_(m,g),x=_(v,f);this._areaRect=o(b,S,E-b,x-S)}_redrawSelectionArea(){const{x:e,y:t,width:s,height:i}=this._areaRect,{style:o}=this._area;o.left=`${e}px`,o.top=`${t}px`,o.width=`${s}px`,o.height=`${i}px`}_onTapStop(e,t){var s;const{document:o,features:l}=this._options,{_singleClick:n}=this;c(this._targetElement,"scroll",this._onStartAreaScroll),c(o,["mousemove","touchmove"],this._delayedTapMove),c(o,["touchmove","mousemove"],this._onTapMove),c(o,["mouseup","touchcancel","touchend"],this._onTapStop),c(o,"scroll",this._onScroll),this._keepSelection(),e&&n&&l.singleTap.allow?this._onSingleTap(e):!n&&!t&&(this._updateElementSelection(),this._emitEvent("stop",e)),this._scrollSpeed.x=0,this._scrollSpeed.y=0,c(this._targetElement,"wheel",this._wheelScroll,{passive:!0}),c(this._options.document,"keydown",this._keyboardScroll,{passive:!0}),this._clippingElement.remove(),null==(s=this._frame)||s.cancel(),i(this._area,"display","none")}_updateElementSelection(){const{_selectables:e,_options:t,_selection:s,_areaRect:i}=this,{stored:o,selected:n,touched:r}=s,{intersect:a,overlap:c}=t.behaviour,h="invert"===c,d=[],u=[],_=[];for(let m=0;m<e.length;m++){const t=e[m];if(l(i,t.getBoundingClientRect(),a)){if(n.includes(t))o.includes(t)&&!r.includes(t)&&r.push(t);else{if(h&&o.includes(t)){_.push(t);continue}u.push(t)}d.push(t)}}h&&u.push(...o.filter(e=>!n.includes(e)));const p="keep"===c;for(let l=0;l<n.length;l++){const e=n[l];!d.includes(e)&&(!p||!o.includes(e))&&_.push(e)}s.selected=d,s.changed={added:u,removed:_},this._latestElement=void 0}_emitEvent(e,t){return this.emit(e,{event:t,store:this._selection,selection:this})}_keepSelection(){const{_options:e,_selection:t}=this,{selected:s,changed:i,touched:o,stored:l}=t,n=s.filter(e=>!l.includes(e));switch(e.behaviour.overlap){case"drop":t.stored=[...n,...l.filter(e=>!o.includes(e))];break;case"invert":t.stored=[...n,...l.filter(e=>!i.removed.includes(e))];break;case"keep":t.stored=[...l,...s.filter(e=>!l.includes(e))]}}trigger(e,t=!0){this._onTapStart(e,t)}resolveSelectables(){this._selectables=d(this._options.selectables,this._options.document)}clearSelection(e=!0,t=!1){const{selected:s,stored:i,changed:o}=this._selection;o.added=[],o.removed.push(...s,...e?i:[]),t||(this._emitEvent("move",null),this._emitEvent("stop",null)),this._selection=v(e?[]:i)}getSelection(){return this._selection.stored}getSelectionArea(){return this._area}getSelectables(){return this._selectables}setAreaLocation(e){Object.assign(this._areaLocation,e),this._redrawSelectionArea()}getAreaLocation(){return this._areaLocation}cancel(e=!1){this._onTapStop(null,!e)}destroy(){this.cancel(),this.disable(),this._clippingElement.remove(),super.unbindAllListeners()}select(e,t=!1){const{changed:s,selected:i,stored:o}=this._selection,l=d(e,this._options.document).filter(e=>!i.includes(e)&&!o.includes(e));return o.push(...l),i.push(...l),s.added.push(...l),s.removed=[],this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null)),l}deselect(e,t=!1){const{selected:s,stored:i,changed:o}=this._selection,l=d(e,this._options.document).filter(e=>s.includes(e)||i.includes(e));this._selection.stored=i.filter(e=>!l.includes(e)),this._selection.selected=s.filter(e=>!l.includes(e)),this._selection.changed.added=[],this._selection.changed.removed.push(...l.filter(e=>!o.removed.includes(e))),this._latestElement=void 0,t||(this._emitEvent("move",null),this._emitEvent("stop",null))}};g.version="3.9.0",e("P",g)}}});
