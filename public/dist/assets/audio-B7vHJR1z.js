import{A as h}from"./APlayer.min-_9IZvi8h.js";import{a0 as k,u as y,P as s,a9 as L,ab as x,o as C,a2 as S,am as U,a5 as A,dW as M,dX as i,x as b}from"./index-CsB5zT4W.js";import{a as R}from"./useTitle-C7kyrev7.js";import{O as m}from"./icon-BfaWsS4s.js";import"./index-Bc2gP8al.js";import"./index-DBnL0RpI.js";const j=()=>{const{proxyLink:p,rawLink:u,previewPage:f}=k(),{searchParams:w}=y();let c=s.objs.filter(r=>r.type===m.AUDIO);(c.length===0||w.from==="search")&&(c=[s.obj]);let e;const v=r=>{let d;const l=s.objs.find(a=>i(a.name)===i(r.name)&&a.name.endsWith(".lrc"));l&&(d=p(l,!0));let t;const n=s.objs.find(a=>a.type===m.IMAGE&&(i(a.name).toLowerCase()===i(r.name).toLowerCase()||i(a.name).toLowerCase()==="front"||i(a.name).toLowerCase()==="cover"||i(a.name).toLowerCase()==="folder"));n?t=u(n,!0):t=r.thumb||b("audio_cover")||"https://res.oplist.org/logo/logo.svg";const o={name:r.name,artist:"Unknown",url:u(r,!0),cover:t,lrc:d};if(s.provider==="NeteaseMusic"){const a=r.name.match(/((.+)\s-\s)?(.+)\.(mp3|flac)/);o.artist=(a==null?void 0:a[2])||"Unknown",o.name=(a==null?void 0:a[3])||r.name;const g=new URL(f(r).replace(/\.(mp3|flac)/,".lrc"));o.lrc=decodeURIComponent(g.pathname)}return o};return L(()=>{e=new h({container:document.querySelector("#audio-player"),mini:!1,autoplay:A("audio_autoplay"),theme:U(),loop:"all",order:"list",preload:"auto",volume:.7,mutex:!0,listFolded:!1,lrcType:s.provider==="NeteaseMusic"?1:3,audio:c.map(v)});const r=e.lrc.switch,d=e.lrc.update;e.lrc.switch=t=>{e.lrc.update=()=>{},r.call(e.lrc,t),e.lrc.update=d},s.provider==="NeteaseMusic"&&e.on("loadstart",()=>{const t=e.list.index;if(!e.list.audios[t].lrc)return;const n=e.list.audios[t].lrc;let o=n;n.startsWith("/@tenant/data")&&(o=n.substring(13)||"/"),M(o).then(a=>{e.lrc.async=!0,e.lrc.parsed[t]=void 0,e.list.audios[t].lrc=a.data.raw_url,e.lrc.switch(t),e.list.audios[t].lrc="",e.lrc.async=!1})});const l=c.findIndex(t=>t.name===s.obj.name);l!==-1&&e.list.switch(l),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("seekto",t=>e.seek(t.seekTime)),e.list.audios.length>1&&(navigator.mediaSession.setActionHandler("previoustrack",()=>{e.skipBack()}),navigator.mediaSession.setActionHandler("nexttrack",()=>{e.skipForward()})),e.on("play",()=>{const t=e.list.audios[e.list.index];R(t.name),navigator.mediaSession.metadata=new MediaMetadata({title:t.name,artist:t.artist==="Unknown"?void 0:t.artist,artwork:[{src:t.cover}]})}))}),x(()=>{e==null||e.destroy()}),C(S,{w:"$full",id:"audio-player"})};export{j as default};
