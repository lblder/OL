System.register(["./index-legacy-VniDFTuT.js","./ResponsiveGrid-legacy-BEd-6pWF.js"],function(e,r){"use strict";var t,n,a,i,u,d,o,g,l,s,c,m,v,h,p,y,f,b,w,$,C,x,_,O,S,k,T,N,F,I,j,q,J,B,M;return{setters:[e=>{t=e.o,n=e.bw,a=e.y,i=e.M,u=e.N,d=e.bg,o=e.bI,g=e.bO,l=e.bx,s=e.bP,c=e.az,m=e.S,v=e.cJ,h=e.bJ,p=e.u,y=e.aZ,f=e.bi,b=e.K,w=e.bN,$=e.g,C=e.bV,x=e.X,_=e.d5,O=e.cP,S=e.W,k=e.cQ,T=e.F,N=e.q,F=e.aM,I=e.bh,j=e.A,q=e.bl,J=e.a3},e=>{B=e.T,M=e.R}],execute:function(){const r=e=>{const r=a();return t(h,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(n,{get for(){return e.name},display:"flex",alignItems:"center",get children(){return r(e.full_name_path??"common"===e.driver?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(i,{get fallback(){return t(c,{get children(){return r("settings.unknown_type")}})},get children(){return[t(u,{get when(){return e.type===B.String},get children(){return t(d,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===B.String?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(u,{get when(){return e.type===B.Number},get children(){return t(d,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===B.Number?r=>e.onChange?.(parseInt(r.currentTarget.value)):void 0}})}}),t(u,{get when(){return e.type===B.Float},get children(){return t(d,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===B.Float?r=>e.onChange?.(parseFloat(r.currentTarget.value)):void 0}})}}),t(u,{get when(){return e.type===B.Bool},get children(){return t(o,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===B.Bool?r=>e.onChange?.(r.currentTarget.checked):void 0}})}}),t(u,{get when(){return e.type===B.Text},get children(){return t(g,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===B.Text?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(u,{get when(){return e.type===B.Select},get children(){return t(l,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===B.Select?r=>e.onChange?.(r):void 0},get children(){return t(s,{get readonly(){return e.readonly},get searchable(){return e.type===B.Select&&e.searchable},get options(){return e.options.split(",").map(t=>({key:t,label:r((e.options_prefix??("common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`))+`.${t}`)}))}})}})}})]}}),t(m,{get when(){return e.help},get children(){return t(v,{get children(){return r("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function P(e,r){switch(e){case B.Bool:return!!r&&"true"===r;case B.Number:return r?parseInt(r):0;case B.Float:return r?parseFloat(r):0;default:return r||""}}e("default",()=>{const e=a(),{params:n,back:i,to:u}=p(),{id:d}=n,[o,g]=y(()=>f.get("/admin/driver/list"),!0),[l,s]=b({}),[c,v]=y(()=>f.get(`/admin/storage/get?id=${d}`),!0),[h,R]=y(()=>f.get(`/admin/driver/info?driver=${V.driver}`),!0);d?(async()=>{const e=await v();q(e,async e=>{z(e),D(JSON.parse(e.addition));const r=await R();q(r,e=>s({[V.driver]:e}))})})():(async()=>{const e=await g();q(e,s)})();const[V,z]=w({}),[A,D]=w({}),[G,K]=y(()=>(z("addition",JSON.stringify(A)),f.post("/admin/storage/"+(d?"update":"create"),V))),Q=$(()=>{const e=l()[V.driver]?.config.alert;if(console.log(e),e)return e.split("|")[0]});return t(J,{get loading(){return d?c()||h():o()},get children(){return[t(C,{mb:"$2",get children(){return e("global."+(d?"edit":"add"))}}),t(x,{mb:"$2",spacing:"$2",get children(){return[t(r,{name:"driver",default:"",readonly:void 0!==d,required:!0,searchable:!0,get type(){return B.Select},get options(){return d?V.driver:Object.keys(l()).join(",")},get value(){return V.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:e=>{for(const r of l()[e].common)z(r.name,P(r.type,r.default));D(_(e=>{for(const r in e)delete e[r]}));for(const r of l()[e].additional)D(r.name,P(r.type,r.default));z("driver",e)}}),t(m,{get when(){return Q()},get children(){return t(O,{get status(){return Q()},w:"$full",get children(){return[t(k,{}),S(()=>e(`drivers.config.${V.driver}.alert`))]}})}})]}}),t(M,{get children(){return t(m,{get when(){return l()[V.driver]},get children(){return[t(T,{get each(){return l()[V.driver].common},children:e=>t(r,N(e,{driver:"common",get value(){return V[e.name]},onChange:r=>{z(e.name,r)}}))}),t(T,{get each(){return l()[V.driver].additional},children:e=>t(r,N(e,{get driver(){return V.driver},get value(){return A[e.name]},onChange:r=>{D(e.name,r)}}))})]}})}}),t(F,{mt:"$2",get loading(){return G()},onClick:async()=>{l()[V.driver].config.need_ms&&(I.info(e("manage.add_storage-tips")),window.open(j("/@manage/messenger"),"_blank"));const r=await K();q(r,()=>{I.success(e("global.save_success")),i()},(e,t)=>{r.data.id&&u(`/@manage/storages/edit/${r.data.id}`)})},get children(){return e("global."+(d?"save":"add"))}})]}})})}}});
