import{cf as he,Q as W,av as Z,cg as Q,ch as S,a2 as U,D as e,al as R,g as X,c7 as k,ci as I,N as Y,aM as ee,ao as L,bt as b,cj as fe,ck as me,cl as we,cm as be,cn as Ce,V as x,O as ve,o as _e,B as w,co as $e,b9 as O,as as ye,af as xe,c2 as T,aK as Se,c3 as ke,S as v,I as A,bc as H,ad as Ie,au as Le,K as V,bE as Ee,bF as Ge,cp as Me,aR as Pe,cq as q,r as _,bw as J}from"./index-DKKy_Uoh.js";import{a as Re}from"./useTitle-C5NycKOZ.js";import{s as Oe,g as Te,a as Ae}from"./webauthn-json.browser-ponyfill-CVZeZdny.js";const Ue="https://github.com/alist-org/alist";function ze(s){return he("".concat(s,"-").concat(Ue))}var Be=Z('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const Fe=s=>{const d=W({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var r=Be(),u=r.firstChild,p=u.firstChild,o=p.nextSibling,c=o.firstChild,a=c.nextSibling;return Q(t=>{var i=d.startColor,h=d.endColor;return i!==t.e&&S(c,"stop-color",t.e=i),h!==t.t&&S(a,"stop-color",t.t=h),t},{e:void 0,t:void 0}),r})()};var Ke=Z('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const De=s=>{const d=W({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var r=Ke(),u=r.firstChild,p=u.firstChild,o=p.nextSibling,c=o.firstChild,a=c.nextSibling;return Q(t=>{var i=d.startColor,h=d.endColor;return i!==t.e&&S(c,"stop-color",t.e=i),h!==t.t&&S(a,"stop-color",t.t=h),t},{e:void 0,t:void 0}),r})()},Ne=()=>{const s=U("#a9c6ff","#062b74");return e(R,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(R,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(De,{})}}),e(R,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Fe,{})}})]}})},je=()=>{const s=L("sso_login_enabled"),d=x("sso_login_platform"),r=L("sso_compatibility_mode"),{searchParams:u,to:p}=X(),o=u.token;o!=null&&o!=""&&(k(o),p(decodeURIComponent(u.redirect||I||"/"),!0));function c(a){const t=a.data;t.token&&(k(t.token),p(decodeURIComponent(u.redirect||I||"/"),!0))}if(window.addEventListener("message",c),Y(()=>{window.removeEventListener("message",c)}),s){const a=()=>{const i=b.getUri()+"/auth/sso?method=sso_get_token";if(r){window.location.href=i;return}window.open(i,"authPopup","width=500,height=600")};let t;switch(d){case"Github":t=Ce;break;case"Microsoft":t=be;break;case"Google":t=we;break;case"Dingtalk":t=me;break;default:t=fe}return e(ee,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},Je=()=>{const s=x("logo").split("\n"),d=U(s[0],s.pop()),r=_e(),u=ve(()=>"".concat(r("login.login_to")," ").concat(x("site_title").replace("OpenList","")));Re(u);const p=U("white","$neutral1"),[o,c]=w(localStorage.getItem("username")||""),[a,t]=w(localStorage.getItem("password")||""),[i,h]=w(""),[$,te]=w(!1),[y,ne]=$e("remember-pwd","false"),[E,z]=w(!1),[re,oe]=O(async()=>E()?b.post("/auth/login/ldap",{username:o(),password:a(),otp_code:i()}):b.post("/auth/login/hash",{username:o(),password:ze(a()),otp_code:i()})),[,se]=O((n,l,f,C)=>b.post("/authn/webauthn_finish_login?username="+f,JSON.stringify(l),{headers:{session:n},signal:C})),[,ae]=O((n,l)=>b.get("/authn/webauthn_begin_login?username="+n,{signal:l})),{searchParams:B,to:G}=X(),ie=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,F=L("webauthn_login_enabled"),le=async()=>{te(!$())};let g=null;const K=async n=>{if(!Oe()){n||_.error(r("users.webauthn_not_supported"));return}if(n&&!await ie())return;g==null||g.abort();const l=new AbortController;g=l;const f=n?"":o();!n&&y()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const C=await ae(f,l.signal);J(C,async j=>{try{const m=Te(j.options);m.signal=l.signal,n&&(m.mediation="conditional");const ge=await Ae(m),de=await se(j.session,ge,f,l.signal);q(de,pe=>{_.success(r("login.success")),k(pe.token),G(decodeURIComponent(B.redirect||I||"/"),!0)})}catch(m){m instanceof Error&&m.name!="AbortError"&&_.error(m.message)}})},D=()=>g==null?void 0:g.abort();ye(()=>{F&&(window.addEventListener("beforeunload",D),K(!0))}),Y(()=>{g==null||g.abort(),window.removeEventListener("beforeunload",D)});const M=async()=>{if($())await K();else{y()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const n=await oe();q(n,l=>{_.success(r("login.success")),k(l.token),b.get("/me").then(f=>{J(f,C=>{C.role===2?G(decodeURIComponent(B.redirect||I||"/@manage"),!0):G("/@tenant",!0)})})},(l,f)=>{!P()&&f===402?ce(!0):_.error(l)})}},[P,ce]=w(!1),N=L("ldap_login_enabled"),ue=x("ldap_login_tips");return N&&z(!0),e(Pe,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(xe,{get bgColor(){return p()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(T,{alignItems:"center",justifyContent:"space-around",get children(){return[e(Se,{mr:"$2",boxSize:"$12",get src(){return d()}}),e(ke,{color:"$info9",fontSize:"$2xl",get children(){return u()}})]}}),e(v,{get when(){return!P()},get fallback(){return e(A,{id:"totp",name:"otp",get placeholder(){return r("login.otp-tips")},get value(){return i()},onInput:n=>h(n.currentTarget.value),onKeyDown:n=>{n.key==="Enter"&&M()}})},get children(){return[e(A,{name:"username",get placeholder(){return r("login.username-tips")},get value(){return o()},onInput:n=>c(n.currentTarget.value)}),e(v,{get when(){return!$()},get children(){return e(A,{name:"password",get placeholder(){return r("login.password-tips")},type:"password",get value(){return a()},onInput:n=>t(n.currentTarget.value),onKeyDown:n=>{n.key==="Enter"&&M()}})}}),e(T,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(H,{get checked(){return y()==="true"},onChange:()=>ne(y()==="true"?"false":"true"),get children(){return r("login.remember")}}),e(Ie,{as:"a",target:"_blank",get href(){return r("login.forget_url")},get children(){return r("login.forget")}})]}})]}}),e(Le,{w:"$full",spacing:"$2",get children(){return[e(v,{get when(){return!$()},get children(){return e(V,{colorScheme:"primary",w:"$full",onClick:()=>{P()?h(""):(c(""),t(""))},get children(){return r("login.clear")}})}}),e(V,{w:"$full",get loading(){return re()},onClick:M,get children(){return r("login.login")}})]}}),e(v,{when:N,get children(){return e(H,{w:"$full",get checked(){return E()===!0},onChange:()=>z(!E()),children:ue})}}),e(T,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Ee,{}),e(Ge,{}),e(je,{}),e(v,{when:F,get children(){return e(ee,{cursor:"pointer",boxSize:"$8",as:Me,p:"$0_5",onclick:le})}})]}})]}}),e(Ne,{})]}})};export{Je as default};
