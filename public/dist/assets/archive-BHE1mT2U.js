import{u as Q,aZ as J,ec as ce,ed as de,g as ue,K as d,J as ge,o as e,G as he,B as N,z as V,F as G,E as me,M as fe,N as L,O as we,S as H,V as m,y as X,a3 as be,X as K,r as pe,W as xe,e1 as $e,bL as w,ac as z,au as Z,am as _e,k as ke,cl as ye,cw as ve,D as Ce,aa as Me,ee as je,bM as Se,co as Le,ay as Oe,aD as Pe,af as Be,ag as Ie,_ as O,aA as ze}from"./index-CsB5zT4W.js";import{L as Ae,c as b}from"./List-BEGLanIK.js";import{T as Ee,f as Fe}from"./index-DUExJ8y_.js";import Te from"./Password-BFrN1jfs.js";import{u as De}from"./helper-BNcjg6ml.js";import{g as Re}from"./icon-BfaWsS4s.js";import{c as Ue}from"./mutex-CPrTRTTj.js";import{b as We,x as P,w as qe}from"./style-BhP5neJU.js";import"./viselect-DiY-CsSI.js";import"./index-Bc2gP8al.js";import"./index-DBnL0RpI.js";const Y=n=>{window.open(n,"_blank")},Je=n=>{const{show:l}=We({id:2}),{isMouseSupported:f}=De(),s=()=>ke.list_item_filename_overflow;return e(Me.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(z,{class:"list-item viselect-item",get"data-index"(){return n.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:Ce()}},get cursor(){return f()?"default":"pointer"},"on:click":g=>{n.obj.is_dir?n.jumpCallback():n.url&&Y(n.url)},onContextMenu:g=>{l(g,{props:n})},get children(){return[e(z,{class:"name-box",spacing:"$1",get w(){return b[0].w},get children(){return[e(Z,{class:"icon",boxSize:"$6",get color(){return _e()},get as(){return Re(n.obj)},mr:"$1"}),e(m,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:s()==="multi_line"?"unset":"nowrap","overflow-x":s()==="scrollable"?"auto":"hidden",textOverflow:s()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return n.obj.name},get children(){return n.obj.name}})]}}),e(m,{class:"size",get w(){return b[1].w},get textAlign(){return b[1].textAlign},get children(){return ye(n.obj.size)}}),e(m,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return b[2].w},get textAlign(){return b[2].textAlign},get children(){return ve(n.obj.modified)}})]}})}})},B={extract:{icon:Fe,color:"$success9"},copy_link:{icon:Ee,color:"$info9"},download:{icon:ze,color:"$primary9"}},Ne=()=>{const{copy:n}=Se(),{colorMode:l}=Le(),{isShare:f}=Q();return e(qe,{id:2,animation:"scale",get theme(){return l()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[e(P,{hidden:({props:s})=>s.obj.is_dir,onClick:({props:s})=>{Y(s.url)},get children(){return e(I,{name:"download"})}}),e(P,{hidden:({props:s})=>s.obj.is_dir,onClick:({props:s})=>{n(s.url)},get children(){return e(I,{name:"copy_link"})}}),e(P,{hidden:()=>{const s=Pe.findIndex(g=>g==="decompress");return!f()&&!Be.can(Ie(),s)},onClick:({props:s})=>{Oe.emit("extract",JSON.stringify({inner:s.innerPath,pass:s.pass}))},get children(){return e(I,{name:"extract"})}})]}})},I=n=>{const l=X();return e(z,{spacing:"$2",get children(){return[e(Z,{get p(){return B[n.name].p?"$1":void 0},get as(){return B[n.name].icon},boxSize:"$7",get color(){return B[n.name].color}}),e(m,{get children(){return l("home.toolbar.".concat(n.name))}})]}})},nt=()=>{const n=X(),{pathname:l}=Q(),[f,s]=J(ce),[g,A]=J(de),ee=ue(()=>f()||g());let i="",p="",k="",x=null;const[y,$]=d(""),[te,E]=d(!1),[v,C]=d(!1),[F,re]=d(""),[c,M]=d([]),[j,T]=d(),[ne,D]=d(!1),[ae,R]=d(""),u=Ue(),_=r=>{let a={};return r.forEach(t=>{a[t.name]={...t,children:t.children?_(t.children):null}}),a},S=r=>r.code===200?!1:(r.code===202?w(()=>{i!==""&&E(!0),C(!0),$("")}):$(r.message),!0),U=async r=>{if(await u.acquire(),v()&&i==="")return u.release(),[];if(p===""){const t=await s(l(),O(),i);if(S(t))return u.release(),[];if(t.data.content!==null&&(x=_(t.data.content)),p=t.data.raw_url,k=t.data.sign,re(t.data.comment),t.data.sort!==void 0){let o;t.data.sort.order_by!==""&&(o=t.data.sort.order_by);let h=t.data.sort.order_direction==="desc",le=t.data.sort.extract_folder;w(()=>{T(o),D(h),R(le)})}if(t.data.encrypted&&i==="")return w(()=>{C(!0),$("")}),u.release(),[]}if(x===null){const t=await A(l(),O(),i,"/");if(S(t))return u.release(),[];x=_(t.data.content)}let a=x;for(let t=0;t<r.length;t++){if(a[r[t]].children===null){const o=await A(l(),O(),i,"/"+r.slice(0,t+1).join("/"));if(S(o))return u.release(),[];a[r[t]].children=_(o.data.content)}a=a[r[t]].children}return w(()=>{C(!1),E(!1),$("")}),u.release(),Object.values(a)},[se,W]=d([]);ge(()=>{U(c()).then(r=>W(r))});const q=()=>{U(c()).then(r=>W(r))};q();const oe=()=>{let r=se();j()&&(r=r.sort((t,o)=>(ne()?-1:1)*je(t[j()],o[j()])));let a=ae();if(a!==""){let t=[],o=[];r.forEach(h=>(h.is_dir?t:o).push(h)),r=a==="front"?t.concat(o):o.concat(t)}return r},ie=(r,a)=>{w(()=>{R(""),T(r),a!==void 0&&D(a)})};return e(K,{spacing:"$2",w:"$full",get children(){return[e(he,{pl:"$2",pr:"$2",w:"$full",get children(){return[e(N,{get children(){return e(V,{get currentPage(){return c().length===0},"on:click":()=>M([]),children:"."})}}),e(G,{get each(){return c()},children:(r,a)=>e(N,{get children(){return[e(me,{}),e(V,{get currentPage(){return c().length===a()+1},"on:click":()=>M(c().slice(0,a()+1)),children:r})]}})})]}}),e(fe,{get children(){return[e(L,{get when(){return y()!==""},get children(){return e(we,{get msg(){return y()},disableColor:!0})}}),e(L,{get when(){return v()},get children(){return e(Te,{get title(){return n("home.toolbar.archive.input_password")},password:()=>i,setPassword:r=>i=r,enterCallback:()=>q(),get children(){return e(H,{get when(){return te()},get children(){return e(m,{color:"$danger9",get children(){return n("home.toolbar.archive.incorrect_password")}})}})}})}}),e(L,{get when(){return xe(()=>!v())()&&y()===""},get children(){return e(be,{get loading(){return ee()},get children(){return e(K,{class:"list",w:"$full",spacing:"$1",get children(){return[e(Ae,{sortCallback:ie,disableCheckbox:!0}),e(G,{get each(){return oe()},children:(r,a)=>{let t,o=(c().length>0?"/"+c().join("/"):"")+"/"+r.name;if(!r.is_dir){const h=p.includes("?");t=p+"".concat(h?"&":"?","inner=").concat(pe(o,!0)),i!==""&&(t=t+"&pass=".concat(encodeURIComponent(i))),k!==""&&(t=t+"&sign=".concat(k))}return e(Je,{obj:r,get index(){return a()},jumpCallback:()=>M(c().concat(r.name)),innerPath:o,url:t,pass:i})}}),e(Ne,{})]}})}})}})]}}),e(H,{get when(){return F()!==""},get children(){return[e($e,{}),e(m,{w:"$full",pl:"$1",pr:"$1",get children(){return F()}})]}})]}})};export{nt as default};
