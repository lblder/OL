import{D as t,bH as M,o as I,a5 as V,a6 as o,I as b,bT as G,T as J,bI as Y,bZ as K,aR as P,S as $,H as Q,bU as U,g as Z,b9 as v,bt as y,B as z,bY as O,O as W,c3 as X,af as p,dp as ee,d6 as te,ae as re,d7 as ne,R as k,Q as x,K as ae,r as _,Y as ie,bw as f,am as de}from"./index-DKKy_Uoh.js";import{T as d,R as ue}from"./ResponsiveGrid-TkZ0jMIj.js";const w=e=>{const u=I();return t(U,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(M,{get for(){return e.name},display:"flex",alignItems:"center",get children(){var i;return u(((i=e.full_name_path)!=null?i:e.driver==="common")?"storages.common.".concat(e.name):"drivers.".concat(e.driver,".").concat(e.name))}}),t(V,{get fallback(){return t(P,{get children(){return u("settings.unknown_type")}})},get children(){return[t(o,{get when(){return e.type===d.String},get children(){return t(b,{get id(){return e.name},get type(){return e.name=="password"?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.String?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,i.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===d.Number},get children(){return t(b,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===d.Number?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,parseInt(i.currentTarget.value))}:void 0}})}}),t(o,{get when(){return e.type===d.Float},get children(){return t(b,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===d.Float?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,parseFloat(i.currentTarget.value))}:void 0}})}}),t(o,{get when(){return e.type===d.Bool},get children(){return t(G,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===d.Bool?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,i.currentTarget.checked)}:void 0}})}}),t(o,{get when(){return e.type===d.Text},get children(){return t(J,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===d.Text?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,i.currentTarget.value)}:void 0}})}}),t(o,{get when(){return e.type===d.Select},get children(){return t(Y,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===d.Select?i=>{var n;return(n=e.onChange)==null?void 0:n.call(e,i)}:void 0},get children(){return t(K,{get readonly(){return e.readonly},get searchable(){return e.type===d.Select&&e.searchable},get options(){return e.options.split(",").map(i=>{var n;return{key:i,label:u(((n=e.options_prefix)!=null?n:e.driver==="common"?"storages.common.".concat(e.name,"s"):"drivers.".concat(e.driver,".").concat(e.name,"s"))+".".concat(i))}})}})}})}})]}}),t($,{get when(){return e.help},get children(){return t(Q,{get children(){return u(e.driver==="common"?"storages.common.".concat(e.name,"-tips"):"drivers.".concat(e.driver,".").concat(e.name,"-tips"))}})}})]}})};function F(e,u){switch(e){case d.Bool:return u?u==="true":!1;case d.Number:return u?parseInt(u):0;case d.Float:return u?parseFloat(u):0;default:return u||""}}const oe=()=>{const e=I(),{params:u,back:i,to:n}=Z(),{id:l}=u,[R,B]=v(()=>y.get("/admin/driver/list"),!0),[c,S]=z({}),L=async()=>{const r=await B();f(r,S)},[A,D]=v(()=>y.get("/admin/storage/get?id=".concat(l)),!0),[N,H]=v(()=>y.get("/admin/driver/info?driver=".concat(g.driver)),!0);l?(async()=>{const r=await D();f(r,async a=>{s(a),m(JSON.parse(a.addition));const h=await H();f(h,E=>S({[g.driver]:E}))})})():L();const[g,s]=O({}),[C,m]=O({}),[j,q]=v(()=>(s("addition",JSON.stringify(C)),y.post("/admin/storage/".concat(l?"update":"create"),g))),T=W(()=>{var a;const r=(a=c()[g.driver])==null?void 0:a.config.alert;if(console.log(r),r)return r.split("|")[0]});return t(de,{get loading(){return l?A()||N():R()},get children(){return[t(X,{mb:"$2",get children(){return e("global.".concat(l?"edit":"add"))}}),t(p,{mb:"$2",spacing:"$2",get children(){return[t(w,{name:"driver",default:"",readonly:l!==void 0,required:!0,searchable:!0,get type(){return d.Select},get options(){return l?g.driver:Object.keys(c()).join(",")},get value(){return g.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:r=>{for(const a of c()[r].common)s(a.name,F(a.type,a.default));m(ee(a=>{for(const h in a)delete a[h]}));for(const a of c()[r].additional)m(a.name,F(a.type,a.default));s("driver",r)}}),t($,{get when(){return T()},get children(){return t(te,{get status(){return T()},w:"$full",get children(){return[t(ne,{}),re(()=>e("drivers.config.".concat(g.driver,".alert")))]}})}})]}}),t(ue,{get children(){return t($,{get when(){return c()[g.driver]},get children(){return[t(k,{get each(){return c()[g.driver].common},children:r=>t(w,x(r,{driver:"common",get value(){return g[r.name]},onChange:a=>{s(r.name,a)}}))}),t(k,{get each(){return c()[g.driver].additional},children:r=>t(w,x(r,{get driver(){return g.driver},get value(){return C[r.name]},onChange:a=>{m(r.name,a)}}))})]}})}}),t(ae,{mt:"$2",get loading(){return j()},onClick:async()=>{c()[g.driver].config.need_ms&&(_.info(e("manage.add_storage-tips")),window.open(ie("/@manage/messenger"),"_blank"));const r=await q();f(r,()=>{_.success(e("global.save_success")),i()},(a,h)=>{r.data.id&&n("/@manage/storages/edit/".concat(r.data.id))})},get children(){return e("global.".concat(l?"save":"add"))}})]}})};export{oe as default};
