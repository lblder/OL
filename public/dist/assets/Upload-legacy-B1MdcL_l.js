System.register(["./index-legacy-VniDFTuT.js","./index-legacy-DjvGcIGH.js","./index.esm-legacy-D7Qrz5Vo.js"],function(e,t){"use strict";var r,n,a,o,s,l,i,c,d,u,g,p,h,m,f,w,y,$,b,k,v,x,C,F,S,_,P,D,z,A,R,M,O,X,j,T;return{setters:[e=>{r=e._,n=e.bi,a=e.P,o=e.u,s=e.j,l=e.K,i=e.bN,c=e.o,d=e.S,u=e.bg,g=e.X,p=e.bV,h=e.y,m=e.a2,f=e.bk,w=e.ac,y=e.ai,$=e.V,b=e.cj,k=e.b1,v=e.bh,x=e.am,C=e.aM,F=e.F,S=e.ck,_=e.W,P=e.cl,D=e.cm,z=e.cn,A=e.b5},e=>{R=e.a,M=e.b},e=>{O=e.c,X=e.a,j=e.b,T=e.d}],execute:function(){const t={pending:"neutral",uploading:"info",backending:"info",success:"success",error:"danger"},I=async e=>{let t=[];const r=async(e,n)=>{const a=new Promise((a,o)=>{const s=e=>{console.error(e),o(e)};if(e.isFile)e.file(e=>{const r=new File([e],n+e.name,{type:e.type});t.push(r),console.log(r),a({})},s);else if(e.isDirectory){const t=e.createReader(),o=()=>{t.readEntries(async t=>{for(let a=0;a<t.length;a++)await r(t[a],n+e.name+"/");a({}),t.length>0&&o()},s)};o()}});await a};return await r(e,""),t},E=e=>({name:e.name,path:e.webkitRelativePath?e.webkitRelativePath:e.name,size:e.size,progress:0,speed:0,status:"pending"}),U=async e=>{const t=await O(),r=await X(),n=await j(),a=e.stream().getReader(),o=async()=>{const{done:e,value:s}=await a.read();e||(t.update(s),r.update(s),n.update(s),await o())};return await o(),{md5:t.digest("hex"),sha1:r.digest("hex"),sha256:n.digest("hex")}},L=[{name:"Stream",upload:async(e,t,a,o=!1,s=!1,l=!1)=>{let i=(new Date).valueOf(),c=0,d={"File-Path":encodeURIComponent(e),"As-Task":o,"Content-Type":t.type||"application/octet-stream","Last-Modified":t.lastModified,Password:r(),Overwrite:s.toString()};if(l){const{md5:e,sha1:r,sha256:n}=await U(t);d["X-File-Md5"]=e,d["X-File-Sha1"]=r,d["X-File-Sha256"]=n}const u=await n.put("/fs/put",t,{headers:d,onUploadProgress:e=>{if(e.total){const t=e.loaded/e.total*100|0;a("progress",t);const r=(new Date).valueOf(),n=(r-i)/1e3;if(n>1){const t=(e.loaded-c)/n,o=(e.total-e.loaded)/t;a("speed",t),console.log(o),i=r,c=e.loaded}100===t&&a("status","backending")}}});return 200===u.code?void 0:new Error(u.message)},provider:/.*/},{name:"Form",upload:async(e,t,a,o=!1,s=!1,l=!1)=>{let i=(new Date).valueOf(),c=0;const d=new FormData;d.append("file",t);let u={"File-Path":encodeURIComponent(e),"As-Task":o,"Content-Type":"multipart/form-data","Last-Modified":t.lastModified,Password:r(),Overwrite:s.toString()};if(l){const{md5:e,sha1:r,sha256:n}=await U(t);u["X-File-Md5"]=e,u["X-File-Sha1"]=r,u["X-File-Sha256"]=n}const g=await n.put("/fs/form",d,{headers:u,onUploadProgress:e=>{if(e.total){const t=e.loaded/e.total*100|0;a("progress",t);const r=(new Date).valueOf(),n=(r-i)/1e3;if(n>1){const t=(e.loaded-c)/n,o=(e.total-e.loaded)/t;a("speed",t),console.log(o),i=r,c=e.loaded}100===t&&a("status","backending")}}});return 200===g.code?void 0:new Error(g.message)},provider:/.*/}],V=e=>{const r=h();return c(g,{w:"$full",spacing:"$1",rounded:"$lg",border:"1px solid $neutral7",alignItems:"start",p:"$2",get _hover(){return{border:`1px solid ${x()}`}},get children(){return[c($,{css:{wordBreak:"break-all"},get children(){return e.path}}),c(w,{spacing:"$2",get children(){return[c(S,{get colorScheme(){return t[e.status]},get children(){return r(`home.upload.${e.status}`)}}),c($,{get children(){return[_(()=>P(e.speed)),"/s"]}})]}}),c(D,{w:"$full",trackColor:"$info3",rounded:"$full",get value(){return e.progress},size:"sm",get children(){return c(z,{get color(){return x()},rounded:"$md"})}}),c($,{color:"$danger10",get children(){return e.msg}})]}})};e("default",()=>{const e=h(),{pathname:t}=o(),{refresh:r}=s(),[n,S]=l(!1),[_,P]=l(!1),[D,z]=l(!1),[O,X]=l(!1),[j,U]=l(!0),[B,G]=i({uploads:[]});let H,K;const N=async e=>{if(0!==e.length){P(!0);for(const t of e){const e=E(t);G("uploads",t=>[...t,e])}for await(const t of T(3,e,Y))console.log(t);r(void 0,!0)}},W=(e,t,r)=>{G("uploads",t=>t.path===e,t,r)},q=L.filter(e=>e.provider.test(a.provider)),[J,Q]=l(q[0]),Y=async e=>{const r=e.webkitRelativePath?e.webkitRelativePath:e.name;W(r,"status","uploading");const n=A(t(),r);try{const t=await J().upload(n,e,(e,t)=>{W(r,e,t)},D(),O(),j());t?(W(r,"status","error"),W(r,"msg",t.message)):(W(r,"status","success"),W(r,"progress",100))}catch(a){console.error(a),W(r,"status","error"),W(r,"msg",a.message)}};return c(g,{w:"$full",pb:"$2",spacing:"$2",get children(){return c(d,{get when(){return!_()},get fallback(){return[c(w,{spacing:"$2",get children(){return[c(C,{colorScheme:"accent",onClick:()=>{G("uploads",e=>e.filter(({status:e})=>!["success","error"].includes(e))),console.log(B.uploads)},get children(){return e("home.upload.clear_done")}}),c(d,{get when(){return B.uploads.every(({status:e})=>["success","error"].includes(e))},get children(){return c(C,{onClick:()=>{P(!1)},get children(){return e("home.upload.back")}})}})]}}),c(F,{get each(){return B.uploads},children:e=>c(V,e)})]},get children(){return[c(u,{type:"file",multiple:!0,ref(e){"function"==typeof H?H(e):H=e},display:"none",onChange:e=>{N(Array.from(e.target.files??[]))}}),c(u,{type:"file",multiple:!0,webkitdirectory:!0,ref(e){"function"==typeof K?K(e):K=e},display:"none",onChange:e=>{N(Array.from(e.target.files??[]))}}),c(g,{w:"$full",justifyContent:"center",get border(){return`2px dashed ${n()?x():"$neutral8"}`},rounded:"$lg",spacing:"$4",p:"$6",minH:"$56",onDragOver:e=>{e.preventDefault(),S(!0)},onDragLeave:()=>{S(!1)},onDrop:async t=>{t.preventDefault(),t.stopPropagation(),S(!1);const r=[],n=Array.from(t.dataTransfer?.items??[]),a=Array.from(t.dataTransfer?.files??[]);let o=n.length;const s=[];for(let e=0;e<o;e++){const t=n[e].webkitGetAsEntry();t?.isFile?r.push(a[e]):t?.isDirectory&&s.push(t)}for(const e of s){const t=await I(e);r.push(...t)}0===r.length&&v.warning(e("home.upload.no_files_drag")),N(r)},get children(){return c(d,{get when(){return!n()},get fallback(){return c(p,{get children(){return e("home.upload.release")}})},get children(){return[c(p,{size:"lg",textAlign:"center",get children(){return e("home.upload.upload-tips")}}),c(m,{w:{"@initial":"80%","@md":"30%"},get children(){return c(f,{get value(){return J().name},onChange:e=>{Q(q.find(t=>t.name===e))},get options(){return q.map(e=>({label:e.name,value:e.name}))}})}}),c(w,{spacing:"$4",get children(){return[c(g,{spacing:"$2",alignItems:"center",get children(){return[c(y,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_folder")},colorScheme:"accent",get icon(){return c(R,{size:"1.2em"})},onClick:()=>{K.click()}}),c($,{fontSize:"$sm",color:"$neutral11",textAlign:"center",get children(){return e("home.upload.upload_folder")}})]}}),c(g,{spacing:"$2",alignItems:"center",get children(){return[c(y,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_files")},get icon(){return c(M,{size:"1.2em"})},onClick:()=>{H.click()}}),c($,{fontSize:"$sm",color:"$neutral11",textAlign:"center",get children(){return e("home.upload.upload_files")}})]}})]}}),c(b,{spacing:{"@initial":"$2","@md":"$4"},direction:{"@initial":"column","@md":"row"},get children(){return[c(k,{get checked(){return D()},onChange:()=>{z(!D())},get children(){return e("home.upload.add_as_task")}}),c(k,{get checked(){return O()},onChange:()=>{X(!O())},get children(){return e("home.conflict_policy.overwrite_existing")}}),c(k,{get checked(){return j()},onChange:()=>{U(!j())},get children(){return e("home.upload.try_rapid")}})]}})]}})}})]}})}})})}}});
